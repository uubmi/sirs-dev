<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>




<head>
  <title>Free Clinic</title>
  <style type="text/css">
	#authenticatonDiv
	{
		position:fixed;
		padding:5%;
		margin:0;
		width: 100%;
		height: 100%;
    	background-color: #9F9F9F;
		color: #FFFFFF;
		text-align:center;
		height:100%;
		width:100%;
	}
	
	#selectPatientDiv
	{
		padding:1%;
		margin:0;
		width: 100%;
		height: 5%;
    	background-color: #9F9F9F;
		color: #FFFFFF;
		text-align:center;
	}
	
	input {margin:5px;}
  </style>


  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<!--I made a new change-->
  <script src="SIRS_criteriaChecker.js" charset="utf-8"></script>
  
  <script>
	// this is the EMR data and patient models - simplified but different than the SIRS CDSS to demonstrate ability to accommodate any model
	var patientObjectsArray = [ 
		{'id':'401','name':'Issac A Lot','gender':'male','temperature':'40'
			,'heartRate':'120'
			,'respiratoryRate':'24'
			,'PaCO2':'23'
			,'whiteBloodCellCount':'15'
			,'bandNeutrophilCount':'0.05'}, //'SIRScriteria':1 SIRS met!
		{'id':'504','name':'Ima Eel Thee','gender':'female','temperature':'37'
			,'heartRate':'70'
			,'respiratoryRate':'15'
			,'PaCO2':'23'
			,'whiteBloodCellCount':'8'
			,'bandNeutrophilCount':'0.05'}, //'SIRScriteria':0 SIRS not met, no missing values	
		{'id':'default','name':'New Patient','gender':'default','temperature':'default'
			,'heartRate':'default'
			,'respiratoryRate':'default'
			,'PaCO2':'default'
			,'whiteBloodCellCount':'default'
			,'bandNeutrophilCount':'default'} //'SIRScriteria':-1 missing values  
	]; 
	
	var clinicianObjects = {'111':{'name':'Jack','role':'Nurse','patients':{'id':'401','id':'504'}},'101':{'name':'Jill','role':'Doctor','patients':{'id':'401','id':'504'}}};
	var currentPatient;
	var currentClinician;
	//create drop down based on patientObjects
	//function dropDownMaker () {}
	function authentication(userID) { 
		
		el = document.getElementById('authenticatonDiv'); 
		if(el.style.display == 'none'){ el.style.display = ''; }
		else { el.style.display = 'none'; } 
		
		el2 = document.getElementById('selectPatientDiv'); 
		if(el2.style.display == 'none'){ el2.style.display = ''; }
		else { el2.style.display = 'none'; } 
		
	  currentClinician = clinicianObjects[userID];
	  console.log(clinicianObjects);
	  console.log(userID);
	  //create dropdown for patient selection
		d3.select("#selectPatients")
			.on("change", function() {
					var patientName = this.value;
				//	alert(patientName);
					populateEHRdata(patientName);
				//	var viewing = this.value;
				//	window.location = [location.href, "?viewing=", viewing].join('');
				})
			.selectAll("option")
			.data(patientObjectsArray)//,function(d){return d.id})
			.enter()
			.append("option")
			//Provide available text for the dropdown options
			//.attr("value",function(d) {return d.key;})
			.text(function(d) {return d.name;});
	
	  //default values into EHR form input fields
		populateEHRdata(patientObjectsArray[0].name);
	
	  //create greeting of Clinician
		el3 = document.getElementById('greetClinician'); 
		if(el3.style.display == 'none'){ 
			el3.style.display = ''; 
			if (typeof currentClinician !== 'undefined') {
				el3.innerHTML = "Wellcome to the Clinic "+currentClinician.role+" "+currentClinician.name;
			}
			else {
				el3.innerHTML = "View only";
			}
		}
		else { el3.style.display = 'none'; } 
		return false; 
	}
	
	//changes values on EHR form input fields
	function populateEHRdata(patient) {
		console.log("meep "+patient+"");
		patientObjectsArray.forEach(function(d) {
			if(d.name == patient ) {
				document.forms["patientData"].reset();
				console.log("hits "+d.name+" "+d.temperature+" ");
				d3.select("#temperature").attr("value",+d.temperature);
					//.on("change",function (){updateValue(d.name,"temperature");});
				d3.select("#heartRate").attr("value",+d.heartRate);
				d3.select("#respiratoryRate").attr("value",+d.respiratoryRate);
				d3.select("#PaCO2").attr("value",+d.PaCO2);
				d3.select("#whiteBloodCellCount").attr("value",+d.whiteBloodCellCount);
				d3.select("#bandNeutrophilCount").attr("value",+d.bandNeutrophilCount);
				
				checkSIRSvalues({"patientData":d,"clinician":currentClinician}); //patient object sent to SIRS_criteriaChecker.js
				//will append result to patient record
				//message contains criteria result, which values were bad, instructions for changing view
				
				
				return true;
			}
		});
	}
	//function updateValue(patient,field) {
	//	patientObjectsArray.forEach(function(d) {
	//		if(d.name == patient ) {
	//			//d.field = 0;
	//		}
	//	}
	//}
  </script>
</head>
<body >
	<div class="mainContent">
		<div id="authenticatonDiv" > <!--needs to cover entire page-->
			<form id="getUserId"><!-- method="post" action="authentication(value);" -->
			<!--get id then alter value on page for id-->
				<div class="question">
					<span div class="questionLable">Enter your unique login ID (for Demo use 111 for Nurse Jack or 101 for Doctor Jill) then press authenticate</span>
                     <span class="choices"><input type="number" id="userID"> <!--onchange="authentication()"--></span></br>
					 <input type="button" value="Authenticate" onclick="authentication(document.getElementById('userID').value)" />
				</div>
			</form>
		</div>

		<div id="greetClinician" style="display:none;">
		</div>
		
		<div id="selectPatientDiv" style="display:none;">
			<!--drop down OR images OR drop-down with images-->
			<!--once patient selected then values populate OR if new patient selected then is blank-->
			Please select a patient 
			<select id="selectPatients" >
			</select>
		</div>
		
		<div id="patientData" name="patientData" >
			<!--responds to drop down in select patient
			Name
			ID
			SIRS Criteria-->
			<form id="patientData">
				<span id="patientName">
				<script></script>
				</span></br>
				<span class="choices">temperature<input type="number" id="temperature"> </span></br>
				<span class="choices">heart rate<input type="number" id="heartRate"> </span></br>
				<span class="choices">respiratory rate<input type="number" id="respiratoryRate"> </span></br>
				<span class="choices">PaCO2<input type="number" id="PaCO2"> </span></br>
				<span class="choices">white blood cell count<input type="number" id="whiteBloodCellCount"></span></br>
				<span class="choices">bandNeutrophilCount<input type="number" id="bandNeutrophilCount"> </span></br>
			</form>	
			<!--script language="javascript">  
				var currentPatientName = url('?viewing');
			</script-->
			<input type="button" value="Log Out?" onclick="authentication()" />
			
			<div id="developmentTesting" >
				<input type="button" value="Run Development Test" onclick="testCases();" />
			
				<script src="sirs-cds.js" charset="utf-8"></script>
				<script src="runCheck.js" charset="utf-8"></script>
				<script>
					//for development testing
					function testCases() {
						for (var i = 0, pat; pat = patients[i++];) {
							console.log("assessing patient #"+i);
							testSIRS(pat);
						}
					}
				</script>
			</div>
			
		</div>
	</div>
</body>
</html>
